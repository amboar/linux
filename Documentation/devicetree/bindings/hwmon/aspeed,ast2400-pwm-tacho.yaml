# SPDX-License-Identifier: (GPL-2.0-only OR BSD-2-Clause)
%YAML 1.2
---
$id: http://devicetree.org/schemas/hwmon/aspeed,ast2400-pwm-tacho.yaml#
$schema: http://devicetree.org/meta-schemas/core.yaml#

title: Aspeed PWM/Tachometer controller

maintainers:
  - Andrew Jeffery <andrew@codeconstruct.com.au>

description: |
  The Aspeed PWM/Tacho controller can support up to 8 fans. There are 8 PWM
  outputs and 16 tachometer inputs, where each fan may have up to two tachometer
  inputs associated with it.

properties:
  compatible:
    enum:
      - aspeed,ast2400-pwm-tacho
      - aspeed,ast2500-pwm-tacho

  reg:
    maxItems: 1

  "#address-cells":
    const: 1

  "#size-cells":
    const: 0

  clocks: true

  resets: true

  "#cooling-cells": true

patternProperties:
  "fan@[0-8]":
    type: object

    description: Fan node

    properties:
      reg:
        description: Fan source port
        maxItems: 1

      cooling-levels: true

      aspeed,fan-tach-ch:
        description: The fan tach input channels
        $ref: /schemas/types.yaml#/definitions/uint8-array
        minItems: 1
        maxItems: 2
        items:
          minimum: 0
          maximum: 15

    additionalProperties: false

additionalProperties: false

examples:
  - |
    #include <dt-bindings/clock/aspeed-clock.h>
    pwm_tacho: pwm@1e786000 {
        compatible = "aspeed,ast2500-pwm-tacho";
        reg = <0x1e786000 0x1000>;
        #address-cells = <1>;
        #size-cells = <1>;
        #cooling-cells = <2>;
        clocks = <&syscon ASPEED_CLK_APB>;
        resets = <&syscon ASPEED_RESET_PWM>;
        pinctrl-names = "default";
        pinctrl-0 = <&pinctrl_pwm0_default &pinctrl_pwm1_default>;

        fan@0 {
            reg = <0x00>;
            cooling-levels = /bits/ 8 <125 151 177 203 229 255>;
            aspeed,fan-tach-ch = /bits/ 8 <0x00>;
        };

        fan@1 {
            reg = <0x01>;
            aspeed,fan-tach-ch = /bits/ 8 <0x01 0x02>;
        };
    };
